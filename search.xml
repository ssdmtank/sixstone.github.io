<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>一些前端面试题目整理和解答</title>
      <link href="/2021/08/08/qian-duan-mian-shi-ti-mu-zheng-li-he-jie-da/"/>
      <url>/2021/08/08/qian-duan-mian-shi-ti-mu-zheng-li-he-jie-da/</url>
      
        <content type="html"><![CDATA[<ol><li>cosnt a = { b: 1 }; a.b = 2 有什么方法让他赋值无效</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>a<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Object.freeze()冻结的是值，你仍然可以将变量的引用替换掉<br>常见的应用场景是对静态或纯数据的展示，可以优化性能</p><ol start="2"><li>arr = [6, 4, 5, 3, 1, 8]能不能用快速排序把数组升序</li></ol><blockquote><p>快排复杂度 排序n个项目要Ο(nlogn)次比较。在最坏状况下则需要Ο(n2)次比较</p></blockquote><h5 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">quickSort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> arr    <span class="token keyword">let</span> left <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>center <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">const</span> baseDot <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> base <span class="token operator">=</span> arr<span class="token punctuation">[</span>baseDot<span class="token punctuation">]</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> base<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            left<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> base<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// 三路快排优化</span>            center<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            right<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">quickSort</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>center<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">quickSort</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'quickSort'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'quickSort'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">threeWayFastSort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 当前数组起始位置大于等于数组的末尾位置时退出递归</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>left <span class="token operator">>=</span> right<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>    <span class="token comment">// 递归执行，将没有大于p和小于p的元素进行三路快拍</span>    <span class="token function">threeWayFastSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>lt<span class="token punctuation">)</span>    <span class="token function">threeWayFastSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>rt<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">partition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token comment">// 基准值为数组的零号元素</span>    <span class="token keyword">let</span> lt <span class="token operator">=</span> left <span class="token comment">// 左区间的初始值</span>    <span class="token keyword">let</span> rt <span class="token operator">=</span> right <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 右区间的初始值</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rt<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            i<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 当前i指向元素p</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// 当前i指向元素大于p 将当前索引和rt-1 元素交换</span>            <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>rt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>rt <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            rt<span class="token operator">--</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>lt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>lt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            lt<span class="token operator">++</span>            i<span class="token operator">++</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// i走向gt处，除了基准值外的元素，其余的空间已经分区完毕，交换基准值与lt处的元素，lt-1，最终得到我们需要的三个区间</span>    <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>lt<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>lt<span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    lt<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>lt <span class="token operator">:</span> lt<span class="token punctuation">,</span> rt <span class="token operator">:</span> rt<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'threeWayFastSort'</span><span class="token punctuation">)</span><span class="token function">threeWayFastSort</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'threeWayFastSort'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token parameter">unsorted</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> pivot <span class="token operator">=</span> array<span class="token punctuation">[</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        left<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">></span> pivot<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        right<span class="token operator">--</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">[</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        left<span class="token operator">++</span><span class="token punctuation">;</span>        right<span class="token operator">--</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> left<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">quick</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> array<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">quick</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">></span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">quick</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> index<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> array<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">quick</span><span class="token punctuation">(</span>unsorted<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> unsorted<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">show</span><span class="token punctuation">(</span>quickSort<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ------------------------------------------</span><span class="token comment">// Method: quickSort</span><span class="token comment">// ------------------------------------------</span><span class="token comment">// before:</span><span class="token comment">// 41,9,22,4,1,32,10,28,4,94,3</span><span class="token comment">// after:</span><span class="token comment">// 1,3,4,4,9,10,22,28,32,41,94 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>实现sleep(1000)的函数</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// es5</span><span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token comment">// promise</span><span class="token keyword">function</span> <span class="token function">sleep1</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">sleep1</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// async</span><span class="token keyword">function</span> <span class="token function">sleep2</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">await</span> <span class="token function">sleep2</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> js基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue数据双向绑定对数组的处理</title>
      <link href="/2021/08/06/vue-shu-ju-shuang-xiang-bang-ding-dui-shu-zu-de-chu-li/"/>
      <url>/2021/08/06/vue-shu-ju-shuang-xiang-bang-ding-dui-shu-zu-de-chu-li/</url>
      
        <content type="html"><![CDATA[<h2 id="Vue不能检测数组变动"><a href="#Vue不能检测数组变动" class="headerlink" title="Vue不能检测数组变动"></a>Vue不能检测数组变动</h2><ol><li>当你利用索引直接设置一个数组项时，例如：vm.items[indexOfItem] = newValue</li><li>当你修改数组的长度时，例如：vm.items.length = newLength</li></ol><p>Object.defineProperty 支持数组监听劫持，<br>但Vue因为性能问题没有提供对数组属性对监听</p><h2 id="vue如何实现对数组监听"><a href="#vue如何实现对数组监听" class="headerlink" title="vue如何实现对数组监听"></a>vue如何实现对数组监听</h2><h4 id="Vue官方提供2种方法"><a href="#Vue官方提供2种方法" class="headerlink" title="Vue官方提供2种方法"></a>Vue官方提供2种方法</h4><ol><li>vm.$set</li><li>arr.splice</li></ol><h4 id="Vue源码里重写里7个内置api"><a href="#Vue源码里重写里7个内置api" class="headerlink" title="Vue源码里重写里7个内置api"></a>Vue源码里重写里7个内置api</h4><ul><li>push()</li><li>pop()</li><li>shift()</li><li>unshift()</li><li>splice()</li><li>sort()</li><li>reverse()</li></ul><h2 id="深入源码"><a href="#深入源码" class="headerlink" title="深入源码"></a>深入源码</h2><h4 id="数组改写原型和通知观察者更新"><a href="#数组改写原型和通知观察者更新" class="headerlink" title="数组改写原型和通知观察者更新"></a>数组改写原型和通知观察者更新</h4><ul><li>创建数组原型，赋值给 arrayMethods</li><li>重写数组原型方法给 arrayMethods 并修改 this</li><li>observeArray, 对数组改变的数据进行观测，递归遍历 </li><li>通知 wachter 更新视图</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// vue 2.6</span><span class="token comment">// src/core/observer/array.js</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> def <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype <span class="token comment">// 获取数组原型对象</span><span class="token comment">// 生成一个新对象，且__proto__ 指向 数组原型对象Array.prototype</span><span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span><span class="token comment">// 列出需要重写的数组方法名</span><span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token string">'push'</span><span class="token punctuation">,</span>  <span class="token string">'pop'</span><span class="token punctuation">,</span>  <span class="token string">'shift'</span><span class="token punctuation">,</span>  <span class="token string">'unshift'</span><span class="token punctuation">,</span>  <span class="token string">'splice'</span><span class="token punctuation">,</span>  <span class="token string">'sort'</span><span class="token punctuation">,</span>  <span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token comment">/** * 遍历上述数组方法名，依次将上述重写后的数组方法添加到arrayMethods对象上 */</span>methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token comment">//缓存原始方法</span>  <span class="token comment">// 将重写后的方法定义到arrayMethods对象上，function mutator() &#123;&#125;就是重写后的方法</span>  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 调用数组原始方法，并传入参数args，并将执行结果赋给result</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>    <span class="token comment">// 当数组调用重写后的方法时，this指向该数组，当该数组为响应式时，就可以获取到其__ob__属性</span>    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__    <span class="token keyword">let</span> inserted    <span class="token comment">// 由于 push、unshift、splice 三个数组方法会新增数组元素，我们只要将新增的元素 inserted 转换为响应式数据即可</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args        <span class="token keyword">break</span>      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token comment">// 获取插入的值，并设置响应式监听</span>    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 通知依赖像更新</span>    <span class="token comment">// 最后返回执行结果result</span>    <span class="token keyword">return</span> result  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>重写完数组的上述7种方法外，我们还需要将这些重写的方法应用到数组上，因此在Observer构造函数中，可以看到在监听数据时会判断数据类型是否为数组。<br>当为数组时，</p><ul><li>如果浏览器支持__proto__，则直接将当前数据的原型__proto__指向重写后的数组方法对象arrayMethods，</li><li>如果浏览器不支持__proto__，则直接将arrayMethods上重写的方法直接定义到当前数据对象上；当数据类型为非数组时，继续递归执行数据的监听。</li></ul><h4 id="和对象不同，数组依赖存放在-Observer-中"><a href="#和对象不同，数组依赖存放在-Observer-中" class="headerlink" title="和对象不同，数组依赖存放在 Observer 中"></a>和对象不同，数组依赖存放在 Observer 中</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/core/observer/index.js </span><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>  value<span class="token operator">:</span> any<span class="token punctuation">;</span>  dep<span class="token operator">:</span> Dep<span class="token punctuation">;</span>  vmCount<span class="token operator">:</span> number<span class="token punctuation">;</span>   <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">// def为defineProperty的封装，函数签名为def(obj, key, val, enumerable)</span>    <span class="token comment">// 将 Observer 的实例设置在私有属性__ob__上，所以无论依赖收集还是通知，都是通过 Observer 实例__ob__上的 dep 属性来操作的。</span>    <span class="token comment">// 同时__ob__也成了判断数据是否是响应式的依据，有该属性数据就是响应式的。</span>    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token comment">// 如果是数组，先篡改数组的一些方法(push,splice,shift等等)，使其能够支持响应式</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span> <span class="token comment">// 改写数组原型方法</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span> <span class="token comment">// 复制数组已有方法</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// 数组里面的元素还是数组或者对象，递归地调用 observe 函数，使其成为响应式数据</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 遍历对象，使其每个键值也能成为响应式数据    </span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 将对象的键值转换成 getter / setter，</span>      <span class="token comment">// getter 收集依赖</span>      <span class="token comment">// setter 通知 watcher 更新</span>      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">/**   * Observe a list of Array items.   */</span>  <span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">/**   * 改写原型方法，把原型改写指向 arrayMethods   */</span>  <span class="token keyword">function</span> <span class="token function">protoAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> src<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> src  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解Promise的几个方法</title>
      <link href="/2021/08/05/li-jie-promise-de-ji-ge-fang-fa/"/>
      <url>/2021/08/05/li-jie-promise-de-ji-ge-fang-fa/</url>
      
        <content type="html"><![CDATA[<p><em>Promise</em> 是异步编程的一种解决方案。</p><h2 id="Promise常见的静态方法"><a href="#Promise常见的静态方法" class="headerlink" title="Promise常见的静态方法"></a>Promise常见的静态方法</h2><ul><li>Prmose.all()<br>  方法返回的Promise会等到参数中所有的Promise都成功之后才会成功，只要其中有一个失败了则返回的Promise也会立即失败，不会等到那些还挂起的承诺有结果</li><li>Promise.allSettled()<br>  方法返回的Promise对象会等到参数中所有的Promise对象都完成后才成功，无论怎样该方法返回的Promise都不会失败</li><li>Promise.any()<br>  方法返回一组Promise中最快成功的那个Promise，如果参数中所有Promise都失败了，那么返回的Promise也失败</li><li>Promise.race()<br>  方法返回参数中最快的那个Promise，如果最快的那个Promise成功则返回的Promise也会成功，否则就是失败，不会等到那些还挂起的Promise有结果</li></ul><blockquote><p>Promise.race 返回参数中<strong>最快</strong>的那个Promise，无论它是成功还是失败。<br>Promise.any 关注的是参数中<strong>最快</strong>同时还必须<strong>成功</strong>的那个Promise。</p></blockquote><blockquote><p>Promise.all 方法需要参数中的所有Promise都<strong>成功</strong><br>Promise.allSettled 对参数中的Promise是成功还是失败并不关心，只要有<strong>结果</strong>就行</p></blockquote><h2 id="实现allSettled"><a href="#实现allSettled" class="headerlink" title="实现allSettled"></a>实现allSettled</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>promises<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">const</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>        promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    status<span class="token operator">:</span> <span class="token string">'fulfilled'</span><span class="token punctuation">,</span>                    value                <span class="token punctuation">&#125;</span>                num<span class="token operator">++</span>                <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                    status<span class="token operator">:</span> <span class="token string">'rejected'</span><span class="token punctuation">,</span>                    reason                <span class="token punctuation">&#125;</span>                num<span class="token operator">++</span>                <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="实现allSettled-1"><a href="#实现allSettled-1" class="headerlink" title="实现allSettled"></a>实现allSettled</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>promises<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="实现all"><a href="#实现all" class="headerlink" title="实现all"></a>实现all</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>promises<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">const</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>        promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>                <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                    result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> res                    num<span class="token operator">++</span>                    <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="实现any"><a href="#实现any" class="headerlink" title="实现any"></a>实现any</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">any</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>promises<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AggregateError</span><span class="token punctuation">(</span><span class="token string">'No Promise in Promise.any was resolved'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">const</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AggregateError</span><span class="token punctuation">(</span><span class="token string">'No Promise in Promise.any was resolved'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>        <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> err          num<span class="token operator">++</span>          <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> js基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js浮点数精度计算</title>
      <link href="/2021/08/04/js-fu-dian-shu-jing-du-ji-suan/"/>
      <url>/2021/08/04/js-fu-dian-shu-jing-du-ji-suan/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>浮点数计算精度不准确</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 加法</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.30000000000000004</span><span class="token comment">// 减法</span><span class="token number">0.3</span> <span class="token operator">-</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.09999999999999998</span><span class="token comment">// 乘法</span><span class="token number">0.3</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0.8999999999999999</span><span class="token comment">// 除法</span><span class="token number">0.3</span> <span class="token operator">/</span> <span class="token number">0.1</span> <span class="token operator">=</span> <span class="token number">2.9999999999999996</span><span class="token comment">// 保留小数</span><span class="token number">3.335</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"3.33499999999999996447"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul><li>在计算机角度，计算机算的是二进制，而不是十进制。</li><li>二进制后变成了无线不循环的数，而计算机可支持浮点数的小数部分可支持到52位。</li></ul><table><thead><tr><th align="center">十进制</th><th align="center">二进制</th></tr></thead><tbody><tr><td align="center">0.1</td><td align="center">0.0001 1001 1001 1001 …</td></tr><tr><td align="center">0.2</td><td align="center">0.0011 0011 0011 0011 …</td></tr><tr><td align="center">0.3</td><td align="center">0.0100 1100 1100 1100 …</td></tr><tr><td align="center">0.4</td><td align="center">0.0110 0110 0110 0110 …</td></tr><tr><td align="center">0.5</td><td align="center">0.1</td></tr><tr><td align="center">0.6</td><td align="center">0.1001 1001 1001 1001 …</td></tr></tbody></table><blockquote><p>小数转二进制的方法： 对小数点以后的数乘以2，有一个结果吧，取结果的整数部分（不是1就是0），然后再用小数部分再乘以2，再取结果的整数部分……以此类推，直到小数部分为0或者位数已经够了。</p></blockquote><p> 演示： </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token number">0.125</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.0</span><span class="token number">0.25</span>  × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.5</span>  <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.0</span><span class="token number">0.5</span>   × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>验证： 0.001 =&gt;  0×2的0次方+0×2的-1次方+0×2的-2次方+0×2的-3次方=1/8=0.125，正确。</p><h4 id="0-1不能转化二进制"><a href="#0-1不能转化二进制" class="headerlink" title="0.1不能转化二进制"></a>0.1不能转化二进制</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token number">0.1</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.2</span> <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token number">.0</span><span class="token number">0.2</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.4</span> <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token number">.0</span><span class="token number">0.4</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token number">.0</span><span class="token number">0.8</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1.6</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.1</span><span class="token number">0.6</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1.2</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.1</span><span class="token number">0.2</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.4</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token number">.0</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 因为不能得到小数位为0且位数会溢出<br> 所有0.1转化会无限循环 =&gt; 0.0001 1001 1001 1001 …</p><h4 id="toFixed四舍五入不准确性"><a href="#toFixed四舍五入不准确性" class="headerlink" title="toFixed四舍五入不准确性"></a>toFixed四舍五入不准确性</h4><p><img src="/2021/08/04/js-fu-dian-shu-jing-du-ji-suan/toFixed.png" alt="ecmascript 规范对toFixed描述"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token number">1.595</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span>   <span class="token operator">=></span> <span class="token string">"1.59"</span><span class="token number">1.5952</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">2</span></span><span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token string">"1.60"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>按照上图步骤演示<span style="color:red;background:#fff5f5">1.595.toFixed(2) =&gt; “1.59”</span>下处理过程:</p><ul><li>x为1.595，小于$10^{21}$，f为2，要使n➗ $10^f$ - x准确的数学值尽可能接近零，取n为159和n为160，</li><li>159/100-1.595 = -0.004999999999999893</li><li>160/100-1.595 = 0.0050000000000001155</li><li>可以看到最接近0的是 -0.004999999999999893 故n为159，m为159，k为3<br>k−f为1，故a为15，则b为9，所以(1.595).toFixed(1)的结果为1.59</li><li>159/100-1.595 不为1.595, 原理和0.1不能转化二进制一样</li></ul><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="方法1-Math-js"><a href="#方法1-Math-js" class="headerlink" title="方法1 Math.js"></a>方法1 Math.js</h3><ol><li>安装<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install mathjs <span class="token operator">/</span> yarn add mathjs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>封装<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> math <span class="token keyword">from</span> <span class="token string">'mathjs'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 加</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 乘</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 减</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 除</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span><span class="token function">bignumber</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="方法2-浮点数转化整数计算"><a href="#方法2-浮点数转化整数计算" class="headerlink" title="方法2 浮点数转化整数计算"></a>方法2 浮点数转化整数计算</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** 判断是否为整数 */</span><span class="token keyword">const</span> <span class="token function-variable function">isInteger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> obj<span class="token comment">/*** 将浮点数转换为整数* @ param floatNum 浮点数* @ return &#123; time //倍数, num // 整数&#125;*/</span><span class="token keyword">const</span> <span class="token function-variable function">floatToInteger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> times <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment">// 整数不处理</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isInteger</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> times<span class="token punctuation">,</span> num<span class="token punctuation">&#125;</span>    <span class="token comment">// 倍数</span>    times <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">**</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>num<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length    <span class="token comment">// 转换整数</span>    <span class="token keyword">const</span> intNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">*</span> times <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>times<span class="token punctuation">,</span> num<span class="token operator">:</span> num <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">-</span>intNum <span class="token operator">:</span> intNum<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 实现加减乘除运算，确保不丢失精度 * @param num1 &#123;number&#125; 运算数1 * @param num2 &#123;number&#125; 运算数2 * @param digits &#123;number&#125; 精度，保留的小数点数，比如 2, 即保留为两位小数 * @param type &#123;string&#125; 运算类型，有加减乘除（add/subtract/multiply/divide） */</span><span class="token keyword">const</span> <span class="token function-variable function">math</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 先拆解</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> times <span class="token operator">:</span> t1<span class="token punctuation">,</span> num <span class="token operator">:</span> n1<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">floatToInteger</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> times <span class="token operator">:</span> t2<span class="token punctuation">,</span> num <span class="token operator">:</span> n2<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">floatToInteger</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span>    <span class="token keyword">const</span> max <span class="token operator">=</span> t1 <span class="token operator">></span> t2 <span class="token operator">?</span> t1 <span class="token operator">:</span> t2    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token operator">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>t1 <span class="token operator">===</span> t2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// 两个小数位数相同</span>                result <span class="token operator">=</span> n1 <span class="token operator">+</span> n2            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>t1 <span class="token operator">></span> t2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// num1 小数位 大于 num2</span>                result <span class="token operator">=</span> n1 <span class="token operator">+</span> n2 <span class="token operator">*</span> <span class="token punctuation">(</span>t1 <span class="token operator">/</span> t2<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token comment">// num1 小数位 小于 num2</span>                result <span class="token operator">=</span> n1 <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span> <span class="token operator">+</span> n2            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> result <span class="token operator">/</span> max        <span class="token keyword">case</span> <span class="token string">'subtract'</span><span class="token operator">:</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">===</span> t2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                result <span class="token operator">=</span> n1 <span class="token operator">-</span> n2            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">></span> t2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                result <span class="token operator">=</span> n1 <span class="token operator">-</span> n2 <span class="token operator">*</span> <span class="token punctuation">(</span>t1 <span class="token operator">/</span> t2<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                result <span class="token operator">=</span> n1 <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span> <span class="token operator">-</span> n2            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> result <span class="token operator">/</span> max        <span class="token keyword">case</span> <span class="token string">'multiply'</span><span class="token operator">:</span>             <span class="token keyword">return</span> <span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>t1 <span class="token operator">*</span> t2<span class="token punctuation">)</span>        <span class="token keyword">case</span> <span class="token string">'divide'</span><span class="token operator">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>n1 <span class="token operator">/</span> n2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2 <span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">math</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">subtract</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2 <span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">math</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">'subtract'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2 <span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">math</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">'multiply'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">divide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1 <span class="token punctuation">,</span> num2 <span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">math</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">'divide'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">toFixed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"number不是数字"</span><span class="token punctuation">)</span>    <span class="token comment">// 修复toFixed精度问题</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">**</span> s <span class="token operator">*</span> num<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">**</span> s    <span class="token comment">// 补零</span>    result <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// 整数</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>s <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            result <span class="token operator">+=</span> <span class="token string">'.'</span>            result <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> arr <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>s <span class="token operator">-</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> $math <span class="token operator">=</span>  <span class="token punctuation">&#123;</span>  add<span class="token punctuation">,</span>  subtract<span class="token punctuation">,</span>   multiply<span class="token punctuation">,</span>  divide<span class="token punctuation">,</span>  toFixed<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> javascript基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 精度丢失 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es7 async/await</title>
      <link href="/2021/08/03/es7-async-await/"/>
      <url>/2021/08/03/es7-async-await/</url>
      
        <content type="html"><![CDATA[<p>async/await 是 ES7 的标准，Promise 是 ES6 标准，async/await 这套 API 也是用来帮助我们写异步代码的，它是构建在 Promise 之上的。</p><p>async 一般不单独使用，而是和 await 一起使用，一个 async 函数内部可能有 零个 或者 多个 await 。</p><h2 id="为什么要使用-async-？"><a href="#为什么要使用-async-？" class="headerlink" title="为什么要使用 async ？"></a>为什么要使用 async ？</h2><ul><li>隐藏 Promise ，更易于理解</li><li>用同步的思路写异步逻辑</li></ul><h2 id="异常处理-try…catch"><a href="#异常处理-try…catch" class="headerlink" title="异常处理 try…catch"></a>异常处理 try…catch</h2><ol><li>在 async 函数中，异常处理一般是 try…catch ，如果没有进行 try…catch ，await 表达式一旦 reject ，async 函数返回的 Promise 就会 reject 。</li><li>其实结合 Promise 来看，如果一个 Promise 状态敲定为 reject ，并且后续的 then 没有传入 reject 函数，或者没有 catch ，那么就会抛出异常。从这个角度来看，在 async 函数中用 try…catch 来包住 await 表达式，可能就是 catch 住这个异常，并且把这个 reject 信息传到 catch 里面。</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Event Loop详解</title>
      <link href="/2021/07/29/event-loop-xiang-jie/"/>
      <url>/2021/07/29/event-loop-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="EventLoop-事件循环详解"><a href="#EventLoop-事件循环详解" class="headerlink" title="EventLoop 事件循环详解"></a>EventLoop 事件循环详解</h1><h2 id="一、javascript单线程"><a href="#一、javascript单线程" class="headerlink" title="一、javascript单线程"></a>一、javascript单线程</h2><p>JavaScript语言是单线程，即同一个时刻只做一件事。为何？因为，JavaScript作为浏览器脚本语言，如果它同时拥有多个线程，那么，它在操作DOM时，就会造成复杂的同步问题。比如，JavaScript的两个线程对同一个DOM节点进行操作，一个删除DOM，一个修改DOM。那么，浏览器该先执行那个操作呢？所以，为了避免出现此种情况，它只能是单线程。</p><h2 id="二、同步／异步任务"><a href="#二、同步／异步任务" class="headerlink" title="二、同步／异步任务"></a>二、同步／异步任务</h2><p>因为是单线程，所以，JavaScript所有任务都要排队。且只有前一个任务结束，才会执行后一个任务。但是，这会面临着一个问题：前一个任务耗时较长时，后一个任务就不得不一直等待。为解决这个问题，将所有任务分成了两种：</p><ul><li>同步任务<br>在主线程上排队执行的任务。且只有前一个任务执行完毕，后一个任务才会执行。</li><li>异步任务<br>不进主线程，而是进任务队列的任务。且仅当任务队列通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。不对主线程执行后续任务造成阻塞。</li></ul><p>因为增加了多线程并行之后，主线程需要频繁的和多个线程协调任务、调度任务，于是浏览器又进一步引入了事件循环(EventLoop)的机制，来协调多个线程多个事件之间的工作。</p><h2 id="三、宏任务／微任务"><a href="#三、宏任务／微任务" class="headerlink" title="三、宏任务／微任务"></a>三、宏任务／微任务</h2><ul><li> macro-task(宏任务)：包括整体代码script，各种事件回调（dom事件、I/O），setTimeout，setInterval、requestAnimationFrame、setImmediate（Node中的api）等。</li><li> micro-task(微任务)：promise.[then/catch/finally]，MutationObserver (dom变化监听/前端回溯)、process.nextTick（Node中的api）等。</li></ul><h2 id="四、浏览器中事件循环的具体机制执行流程"><a href="#四、浏览器中事件循环的具体机制执行流程" class="headerlink" title="四、浏览器中事件循环的具体机制执行流程"></a>四、浏览器中事件循环的具体机制执行流程</h2><ul><li>简要版： 调用栈为空 -&gt; 执行宏任务队列最早一个宏任务x -&gt; 执行x关联的微任务队列中的所有微任务 -&gt; 调用栈为空 … 如此循环</li><li>详细版：<ol><li>执行一个宏任务(栈中没有就中事件队列中获取)</li><li>执行过程中如果遇到微任务，就将它添加到为任务的任务队列中</li><li>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）</li><li>当前宏任务执行完毕，开始检查渲染</li><li>渲染完毕之后，开始下一个宏任务</li></ol></li></ul><blockquote><p>事件循环处理宏任务和微任务队列的区别：在单次的循环迭代中，最多处理一个宏任务(其余的在队列中等待)，而队列中的所有微任务都会被处理</p></blockquote><p><img src="/2021/07/29/event-loop-xiang-jie/loop-1.png" alt="eventloop流程"></p><h2 id="五、案例"><a href="#五、案例" class="headerlink" title="五、案例"></a>五、案例</h2><h3 id="setTimeout-执行"><a href="#setTimeout-执行" class="headerlink" title="setTimeout 执行"></a>setTimeout 执行</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>   <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token comment">// 假设执行时间远远超过了3秒</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>task() 进入Event Table并注册回掉函数</li><li>执行sleep函数</li><li>3s到了， task进入Event Quene, 但sleep未执行完，只能等待</li><li>sleep执行完毕后，task 从 Event Queue进入主线程执行</li></ol><h3 id="setInterval"><a href="#setInterval" class="headerlink" title="setInterval"></a>setInterval</h3><ol><li>setInterval会每隔指定的时间把注册函数放入Event Quene</li><li>如果前面的任务耗时太久，那么同样需要等待</li><li>对于setInterval(fn,ms)来说，不是每过ms秒会执行一次fn，而是每过ms秒，会有fn进入Event Queue</li></ol><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li> macro-task(宏任务)：包括整体代码script，setTimeout，setInterval</li><li> micro-task(微任务)：promise.then，catch，finally</li></ul><h3 id="练习-1"><a href="#练习-1" class="headerlink" title="练习 1"></a>练习 1</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>setTimeout, 将回调函数注册分发到宏任务Event Quene</li><li>Promise, new Promise立即执行，then函数分发到微任务Event Quene</li><li>console.log 立即执行</li><li>第一个宏任务结束，执行then微任务</li><li>第二轮循环，从宏任务Event Quene中执行setTime回调函数</li></ol><p><img src="/2021/07/29/event-loop-xiang-jie/loop-2.png" alt="这是代替图片的文字，随便写"></p><h3 id="练习-2"><a href="#练习-2" class="headerlink" title="练习 2"></a>练习 2</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// setTimeout1</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// then2</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// then1</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// setTimeout2</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// then3</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="解析-2"><a href="#解析-2" class="headerlink" title="解析 2:"></a>解析 2:</h4><table><thead><tr><th align="center">循环轮次</th><th align="center">宏任务 Event Queue</th><th align="center">微任务 Event Queue</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">输出1</td><td align="center"></td><td align="center">执行第一轮宏任务</td></tr><tr><td align="center">1</td><td align="center">分发setTimeout1</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">1</td><td align="center">输出7</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">1</td><td align="center"></td><td align="center">分发then1</td><td align="center"></td></tr><tr><td align="center">1</td><td align="center">分发setTimeout2</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">1</td><td align="center">第一轮宏任务结束</td><td align="center">执行then1</td><td align="center">执行第一轮微任务</td></tr><tr><td align="center">1</td><td align="center">输出8</td><td align="center">第一轮事件微任务结束</td><td align="center">第一轮事件循环结束</td></tr><tr><td align="center">2</td><td align="center">执行setTimeout1</td><td align="center">执行第二轮宏任务</td><td align="center"></td></tr><tr><td align="center">2</td><td align="center">输出2</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">2</td><td align="center">输出4</td><td align="center">分发then2</td><td align="center">第二轮宏任务结束</td></tr><tr><td align="center">2</td><td align="center"></td><td align="center">执行then2</td><td align="center">执行第二轮微任务</td></tr><tr><td align="center">2</td><td align="center">输出5</td><td align="center">第二轮微任务结束</td><td align="center">第二轮事件循环结束</td></tr><tr><td align="center">3</td><td align="center">执行setTimeout2</td><td align="center"></td><td align="center">执行第三轮宏任务</td></tr><tr><td align="center">3</td><td align="center">输出9</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">3</td><td align="center">输出11</td><td align="center">分发then3</td><td align="center">第三轮宏任务结束</td></tr><tr><td align="center">3</td><td align="center"></td><td align="center">执行then3</td><td align="center">执行第三轮微任务</td></tr><tr><td align="center">3</td><td align="center">输出12</td><td align="center">第三轮微任务结束</td><td align="center">第三轮事件循环结束</td></tr></tbody></table><h3 id="练习-3"><a href="#练习-3" class="headerlink" title="练习 3"></a>练习 3</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// then1</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise1'</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// setTimeout1</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout1"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// setTimeout2</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout2'</span><span class="token punctuation">)</span>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// then 2</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise2'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="解析3"><a href="#解析3" class="headerlink" title="解析3"></a>解析3</h4><table><thead><tr><th align="center">循环轮次</th><th align="center">宏任务 Event Queue</th><th align="center">微任务 Event Queue</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">1</td><td align="center"></td><td align="center">分发then1</td><td align="center">第一轮宏任务开始</td></tr><tr><td align="center">1</td><td align="center">分发setTimeout2</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">1</td><td align="center"></td><td align="center">执行then1</td><td align="center">第一轮微任务开始</td></tr><tr><td align="center">1</td><td align="center">输出Promise1</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">1</td><td align="center">分发setTimeout1</td><td align="center">第一轮事件微任务结束</td><td align="center">第一轮事件循环结束</td></tr><tr><td align="center">2</td><td align="center">执行setTimeout2</td><td align="center"></td><td align="center">第二轮宏任务开始</td></tr><tr><td align="center">2</td><td align="center">输出setTimeout2</td><td align="center">分发then2</td><td align="center">第二轮宏任务结束</td></tr><tr><td align="center">2</td><td align="center"></td><td align="center">执行then2</td><td align="center">第二轮微任务开始</td></tr><tr><td align="center">2</td><td align="center">输出Promise2</td><td align="center">第二轮微任务结束</td><td align="center">第二轮事件循环结束</td></tr><tr><td align="center">3</td><td align="center">执行setTimeout1</td><td align="center"></td><td align="center">第三轮宏任务开始</td></tr><tr><td align="center">3</td><td align="center">输出setTimeout1</td><td align="center"></td><td align="center">第三轮事件循环结束</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端Leetcode</title>
      <link href="/2021/07/27/qian-duan-leetcode/"/>
      <url>/2021/07/27/qian-duan-leetcode/</url>
      
        <content type="html"><![CDATA[<h2 id="前端Leetcode"><a href="#前端Leetcode" class="headerlink" title="前端Leetcode"></a>前端Leetcode</h2><ol><li>给定一个整数数组，判断是否存在重复元素。</li></ol><p>示例 1:<br>输入: [1,2,3,1]<br>输出: true</p><p>示例 2:<br>输入: [1,2,3,4]<br>输出: false</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 解法1 map</span><span class="token keyword">const</span> <span class="token function-variable function">isDuplicateArr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> nums<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span>        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token comment">// 解法2 set</span><span class="token keyword">const</span> <span class="token function-variable function">isDuplicateArr2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">!==</span> nums<span class="token punctuation">.</span>length<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>给定一个字符串，找到它的第一个不重复的字符，并返回它的索引。如果不存在，则返回 -1。</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js">示例：    s <span class="token operator">=</span> <span class="token string">"leetcode"</span>    返回 <span class="token number">0</span>    s <span class="token operator">=</span> <span class="token string">"loveleetcode"</span>    返回 <span class="token number">2</span>    <span class="token comment">// 提示：你可以假定该字符串只包含小写字母</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 解法1 map</span><span class="token keyword">var</span> <span class="token function-variable function">firstUniqueChar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> charStr <span class="token keyword">of</span> str<span class="token punctuation">)</span>  map<span class="token punctuation">[</span>charStr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>charStr<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> i    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token comment">// 解法2</span><span class="token keyword">var</span> <span class="token function-variable function">firstUniqueChar2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> strArr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token comment">// 去除当前循环字符串</span>        strArr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment">// 比较当前循环字符串是否0 11在</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>strArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> i    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写类似vue双向绑定</title>
      <link href="/2021/07/25/shou-xie-lei-si-vue-shuang-xiang-bang-ding/"/>
      <url>/2021/07/25/shou-xie-lei-si-vue-shuang-xiang-bang-ding/</url>
      
        <content type="html"><![CDATA[<h3 id="markdown语法"><a href="#markdown语法" class="headerlink" title="markdown语法"></a>markdown语法</h3> <pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>dd</strong></p>]]></content>
      
      
      <categories>
          
          <category> 手写代码3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手写代码 </tag>
            
            <tag> 手写代码2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World223</title>
      <link href="/2021/07/23/hello-world/"/>
      <url>/2021/07/23/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
